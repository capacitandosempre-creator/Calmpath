<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmPath - Real Time Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQE_OdDTC7u5Rp7QSsTyH3bSg7BdYBeVs&libraries=places"></script>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); transition: transform 0.2s; }
        .badge-closed { background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .badge-open { background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen p-4 pb-20">

    <header class="text-center py-6">
        <h1 class="text-4xl font-bold text-blue-400 tracking-tight">CalmPath</h1>
        <p class="text-slate-400 text-[10px] uppercase tracking-[0.2em]">Intelig칡ncia Sensorial Real</p>
    </header>

    <main class="max-w-md mx-auto space-y-4">
        <div class="glass p-4 rounded-2xl shadow-2xl border border-blue-500/20">
            <input id="search" type="text" placeholder="Ex: Maxi Shopping, Parque da Cidade..." 
                   class="w-full bg-slate-900 border-none rounded-xl p-4 text-white focus:ring-2 focus:ring-blue-500 text-lg">
            <button onclick="buscarLocalReal()" class="w-full mt-3 btn-primary p-4 rounded-xl font-bold text-lg shadow-lg">Analisar Agora</button>
        </div>

        <div id="resultado" class="hidden glass p-6 rounded-2xl animate-fade-in border-t-4 border-blue-500">
            <div class="flex justify-between items-start mb-2">
                <h2 id="nomeLocal" class="text-xl font-bold leading-tight pr-2"></h2>
                <span id="badgeStatus" class=""></span>
            </div>
            <p id="enderecoLocal" class="text-slate-400 text-[11px] mb-4"></p>
            
            <div id="statusCard" class="p-6 rounded-2xl text-center mb-4 transition-all duration-700">
                <span class="text-[10px] uppercase tracking-widest opacity-70">Status de Movimento</span>
                <div id="statusTexto" class="text-3xl font-black my-1 text-white"></div>
                <div id="periodoTexto" class="text-xs opacity-90 italic"></div>
            </div>

            <div class="bg-blue-500/10 border border-blue-500/20 p-4 rounded-xl">
                <h3 class="text-blue-300 text-[10px] font-bold uppercase mb-2 flex items-center tracking-widest">
                    <span class="mr-2">游</span> Melhor janela de hor치rio:
                </h3>
                <p id="melhorHorarioTexto" class="text-slate-200 text-sm font-medium leading-relaxed"></p>
            </div>
        </div>
    </main>

    <div id="paywall" class="hidden fixed inset-0 bg-slate-950/95 backdrop-blur-md z-50 flex items-center justify-center p-6 text-center">
        <div class="glass p-8 rounded-3xl max-w-sm border border-blue-500/30 font-sans">
            <div class="text-5xl mb-4">游</div>
            <h2 class="text-2xl font-bold mb-2">Limite de Teste</h2>
            <p class="text-slate-400 mb-6 font-light">Para continuar analisando locais reais e hor치rios de janela, libere seu acesso ilimitado.</p>
            <a href="https://pay.kiwify.com.br/UvkAxpZ" class="block w-full btn-primary p-4 rounded-xl font-bold mb-4 shadow-lg shadow-blue-500/20">LIBERAR POR R$ 9,90</a>
            <button onclick="abrirLogin()" class="text-blue-400 text-sm underline">J치 sou assinante</button>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-slate-950/90 z-[60] flex items-center justify-center p-6">
        <div class="glass p-8 rounded-3xl w-full max-w-xs text-center border border-white/10">
            <input id="senhaInput" type="password" placeholder="Sua Senha" class="w-full bg-slate-800 p-3 rounded-lg mb-4 text-center text-white outline-none">
            <button onclick="validarSenha()" class="w-full btn-primary p-3 rounded-lg font-bold">Validar</button>
        </div>
    </div>

    <script>
        const SENHA_MESTRA = "Calmpath26";
        let searches = parseInt(localStorage.getItem('calmpath_searches')) || 0;
        let isPremium = localStorage.getItem('calmpath_premium') === 'true';

        function abrirLogin() { document.getElementById('loginModal').classList.remove('hidden'); }
        function validarSenha() {
            if (document.getElementById('senhaInput').value === SENHA_MESTRA) {
                localStorage.setItem('calmpath_premium', 'true');
                location.reload();
            } else { alert("Senha incorreta."); }
        }

        function buscarLocalReal() {
            const query = document.getElementById('search').value;
            if (query.length < 3) return alert("Digite o nome de um local.");
            if (!isPremium && searches >= 3) { document.getElementById('paywall').classList.remove('hidden'); return; }

            const service = new google.maps.places.PlacesService(document.createElement('div'));
            const request = { query: query, fields: ['name', 'formatted_address', 'opening_hours', 'types'] };

            service.findPlaceFromQuery(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results[0]) {
                    const local = results[0];
                    processarDados(local);
                    if (!isPremium) { searches++; localStorage.setItem('calmpath_searches', searches); }
                } else { alert("Local n칚o encontrado."); }
            });
        }

        function processarDados(local) {
            const agora = new Date();
            const hora = agora.getHours();
            const dia = agora.getDay();
            
            const estaAberto = local.opening_hours ? local.opening_hours.isOpen() : true;
            const badge = document.getElementById('badgeStatus');
            
            // Define Status e Cor
            let status, cor, desc;
            
            if (!estaAberto) {
                badge.innerText = "FECHADO AGORA"; badge.className = "badge-closed";
                status = "Inativo"; cor = "bg-slate-800"; desc = "Este local est치 fechado no momento.";
            } else {
                badge.innerText = "ABERTO"; badge.className = "badge-open";
                const tipos = local.types || [];
                const isComercial = tipos.includes('shopping_mall') || tipos.includes('store');
                
                if (isComercial) {
                    if ((dia === 0 || dia === 6) && (hora >= 14 && hora <= 20)) {
                        status = "Muito Agitado"; cor = "bg-red-600"; desc = "Pico de fluxo intenso.";
                    } else if (hora >= 12 && hora <= 14) {
                        status = "Agitado"; cor = "bg-orange-600"; desc = "Hor치rio de almo칞o/pico.";
                    } else {
                        status = "Tranquilo"; cor = "bg-emerald-600"; desc = "Movimenta칞칚o baixa no momento.";
                    }
                } else {
                    if (hora >= 10 && hora <= 16) {
                        status = "Moderado"; cor = "bg-amber-600"; desc = "Fluxo normal para o local.";
                    } else {
                        status = "Muito Calmo"; cor = "bg-emerald-600"; desc = "Excelente momento sensorial.";
                    }
                }
            }

            // Exibe na tela
            document.getElementById('nomeLocal').innerText = local.name.toUpperCase();
            document.getElementById('enderecoLocal').innerText = local.formatted_address;
            document.getElementById('statusTexto').innerText = status;
            document.getElementById('statusCard').className = `p-6 rounded-2xl text-center mb-4 ${cor}`;
            document.getElementById('periodoTexto').innerText = desc;
            
            // GERA A JANELA DE HOR츼RIO (A corre칞칚o aqui)
            document.getElementById('melhorHorarioTexto').innerText = gerarDicaHorario(local.types);
            
            document.getElementById('resultado').classList.remove('hidden');
            document.getElementById('resultado').scrollIntoView({ behavior: 'smooth' });
        }

        function gerarDicaHorario(tipos) {
            if (tipos.includes('shopping_mall')) return "Dias 칰teis entre 10h e 11h30 ou ap칩s as 20h30. Evite domingos  tarde.";
            if (tipos.includes('park') || tipos.includes('cemetery')) return "Primeira hora da manh칚 (8h 맙 10h) ou final de tarde em dias de semana.";
            if (tipos.includes('hospital') || tipos.includes('drugstore')) return "Madrugada ou entre 14h e 16h (ap칩s o almo칞o).";
            return "Per칤odo da manh칚, logo ap칩s a abertura, costuma ser o mais silencioso.";
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmPath - Real Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQE_OdDTC7u5Rp7QSsTyH3bSg7BdYBeVs&libraries=places"></script>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); transition: transform 0.2s; }
        .btn-primary:active { transform: scale(0.95); }
        .badge-closed { background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .badge-open { background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen p-4 pb-20">

    <header class="text-center py-6">
        <h1 class="text-4xl font-bold text-blue-400 tracking-tight">CalmPath</h1>
        <p class="text-slate-400 text-[10px] uppercase tracking-[0.2em]">Intelig√™ncia Sensorial Real</p>
    </header>

    <main class="max-w-md mx-auto space-y-6">
        
        <section class="text-center px-4">
            <h2 class="text-lg font-semibold text-slate-200">Planeje sua paz.</h2>
            <p class="text-slate-400 text-sm mt-1">Analisamos locais reais para voc√™ evitar multid√µes.</p>
        </section>

        <div class="glass p-5 rounded-3xl shadow-2xl border border-blue-500/30">
            <input id="search" type="text" placeholder="Ex: Shopping Maxi, Parque da Cidade..." 
                   class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white focus:ring-2 focus:ring-blue-500 text-lg outline-none mb-3">
            
            <button onclick="buscarLocalReal()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg shadow-lg mb-4">
                Analisar Agora
            </button>
            
            <div class="border-t border-slate-800 pt-3">
                <div id="contagemBuscas" class="text-center text-blue-400 text-xs font-bold uppercase tracking-widest">
                    Buscas gr√°tis: <span id="numBuscas" class="text-white">3</span> restantes
                </div>
            </div>
        </div>

        <div class="text-center pt-2">
            <button onclick="abrirLogin()" class="bg-slate-800/50 hover:bg-slate-800 px-6 py-3 rounded-full text-blue-400 text-xs font-bold border border-blue-500/20 transition-all">
                üîì J√Å SOU ASSINANTE / VALIDAR SENHA
            </button>
        </div>

        <div id="resultado" class="hidden glass p-6 rounded-2xl animate-fade-in border-t-4 border-blue-500 mt-6">
            <div class="flex justify-between items-start mb-2">
                <h2 id="nomeLocal" class="text-xl font-bold leading-tight pr-2"></h2>
                <span id="badgeStatus" class=""></span>
            </div>
            <p id="enderecoLocal" class="text-slate-400 text-[11px] mb-4"></p>
            
            <div id="statusCard" class="p-6 rounded-2xl text-center mb-4">
                <span class="text-[10px] uppercase tracking-widest opacity-70 text-white font-bold">Tend√™ncia Atual</span>
                <div id="statusTexto" class="text-3xl font-black my-1 text-white"></div>
                <div id="periodoTexto" class="text-xs opacity-90 italic text-white"></div>
            </div>

            <div class="bg-blue-500/10 border border-blue-500/20 p-4 rounded-xl">
                <h3 class="text-blue-300 text-[10px] font-bold uppercase mb-2 flex items-center tracking-widest">
                    <span class="mr-2">üïí</span> Janela de Hor√°rio Recomendada:
                </h3>
                <p id="melhorHorarioTexto" class="text-slate-200 text-sm font-medium leading-relaxed"></p>
            </div>
        </div>
    </main>

    <div id="paywall" class="hidden fixed inset-0 bg-slate-950/98 backdrop-blur-xl z-50 flex items-center justify-center p-6 text-center">
        <div class="glass p-8 rounded-3xl max-w-sm border border-blue-500/40">
            <div class="text-6xl mb-4">üîí</div>
            <h2 class="text-2xl font-bold mb-2 text-white">Limite Atingido</h2>
            <p class="text-slate-400 mb-6">Para continuar analisando locais e descobrir as melhores janelas de hor√°rio, libere seu acesso ilimitado.</p>
            <a href="https://pay.kiwify.com.br/UvkAxpZ" class="block w-full btn-primary p-4 rounded-xl font-bold mb-4 shadow-lg shadow-blue-500/20 text-white">LIBERAR ACESSO POR R$ 9,90</a>
            <button onclick="abrirLogin()" class="text-blue-400 text-sm font-bold underline">J√° comprou? Digite sua senha</button>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-slate-950/95 z-[60] flex items-center justify-center p-6 text-center">
        <div class="glass p-8 rounded-3xl w-full max-w-xs border border-white/20">
            <h3 class="text-xl font-bold mb-2 text-blue-400">Acesso Membro</h3>
            <p class="text-slate-400 text-[10px] mb-4 uppercase tracking-tighter">Digite a senha enviada pela Kiwify</p>
            <input id="senhaInput" type="password" placeholder="Sua Senha" 
                   class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl mb-4 text-center text-white focus:ring-2 focus:ring-blue-500 outline-none">
            <button onclick="validarSenha()" class="w-full btn-primary p-4 rounded-xl font-bold">Validar Acesso</button>
            <button onclick="document.getElementById('loginModal').classList.add('hidden')" class="mt-4 text-slate-500 text-[10px] uppercase font-bold">Fechar</button>
        </div>
    </div>

    <script>
        const SENHA_MESTRA = "Calmpath26";
        let searches = parseInt(localStorage.getItem('calmpath_searches')) || 0;
        let isPremium = localStorage.getItem('calmpath_premium') === 'true';

        // Inicializa√ß√£o
        window.onload = atualizarUI;

        function atualizarUI() {
            const displayContador = document.getElementById('contagemBuscas');
            const displayNum = document.getElementById('numBuscas');
            
            if (isPremium) {
                displayContador.innerHTML = "‚ú® <span class='text-blue-400 font-bold'>ACESSO ILIMITADO ATIVO</span>";
                document.getElementById('paywall').classList.add('hidden');
            } else {
                displayNum.innerText = Math.max(0, 3 - searches);
            }
        }

        function abrirLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function validarSenha() {
            const input = document.getElementById('senhaInput').value;
            if (input === SENHA_MESTRA) {
                localStorage.setItem('calmpath_premium', 'true');
                isPremium = true;
                alert("Parab√©ns! Seu acesso ilimitado foi ativado.");
                document.getElementById('loginModal').classList.add('hidden');
                atualizarUI();
            } else {
                alert("Senha incorreta. Verifique o e-mail enviado pela Kiwify.");
            }
        }

        function buscarLocalReal() {
            const query = document.getElementById('search').value;
            if (query.length < 3) return alert("Por favor, digite o nome de um local.");

            if (!isPremium && searches >= 3) {
                document.getElementById('paywall').classList.remove('hidden');
                return;
            }

            const service = new google.maps.places.PlacesService(document.createElement('div'));
            const request = { query: query, fields: ['name', 'formatted_address', 'opening_hours', 'types'] };

            service.findPlaceFromQuery(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results[0]) {
                    const local = results[0];
                    
                    if (!isPremium) {
                        searches++;
                        localStorage.setItem('calmpath_searches', searches);
                        atualizarUI();
                    }

                    mostrarDados(local);
                } else {
                    alert("Local n√£o encontrado. Tente adicionar a cidade ao nome.");
                }
            });
        }

        function mostrarDados(local) {
            const agora = new Date();
            const hora = agora.getHours();
            const dia = agora.getDay();
            const estaAberto = local.opening_hours ? local.opening_hours.isOpen() : true;
            const badge = document.getElementById('badgeStatus');
            
            let status, cor, desc;
            
            if (!estaAberto) {
                badge.innerText = "FECHADO AGORA"; badge.className = "badge-closed";
                status = "Inativo"; cor = "bg-slate-800"; desc = "Este local est√° fechado no momento.";
            } else {
                badge.innerText = "ABERTO"; badge.className = "badge-open";
                const tipos = local.types || [];
                const isComercial = tipos.includes('shopping_mall') || tipos.includes('store') || tipos.includes('supermarket');

                if (isComercial) {
                    if ((dia === 0 || dia === 6) && (hora >= 14 && hora <= 19)) {
                        status = "Muito Agitado"; cor = "bg-red-600"; desc = "Pico de fluxo de final de semana.";
                    } else if (hora >= 12 && hora <= 14 || hora >= 18 && hora <= 20) {
                        status = "Agitado"; cor = "bg-orange-600"; desc = "Hor√°rio de pico comercial.";
                    } else {
                        status = "Tranquilo"; cor = "bg-emerald-600"; desc = "Movimenta√ß√£o calma e agrad√°vel.";
                    }
                } else {
                    // Parques, Cemit√©rios, Locais P√∫blicos
                    status = (hora >= 10 && hora <= 16) ? "Moderado" : "Muito Calmo";
                    cor = (status === "Moderado") ? "bg-amber-600" : "bg-emerald-600";
                    desc = (status === "Moderado") ? "Fluxo normal de visitantes." : "Momento ideal para evitar barulho.";
                }
            }

            document.getElementById('nomeLocal').innerText = local.name.toUpperCase();
            document.getElementById('enderecoLocal').innerText = local.formatted_address;
            document.getElementById('statusTexto').innerText = status;
            document.getElementById('statusCard').className = `p-6 rounded-2xl text-center mb-4 ${cor} transition-all duration-500`;
            document.getElementById('periodoTexto').innerText = desc;
            document.getElementById('melhorHorarioTexto').innerText = gerarDica(local.types);
            
            document.getElementById('resultado').classList.remove('hidden');
            document.getElementById('resultado').scrollIntoView({ behavior: 'smooth' });
        }

        function gerarDica(tipos) {
            if (tipos.includes('shopping_mall')) return "Dias √∫teis entre 10h e 11h30 ou ap√≥s as 20h30. Evite domingos √† tarde.";
            if (tipos.includes('park') || tipos.includes('cemetery')) return "Primeira hora da manh√£ (8h √†s 10h) ou final de tarde em dias de semana.";
            if (tipos.includes('supermarket')) return "Ter√ßas e Quartas-feiras ou ap√≥s as 21h.";
            return "O per√≠odo da manh√£, logo ap√≥s a abertura, costuma ser o mais silencioso neste tipo de local.";
        }
    </script>
</body>
</html>
